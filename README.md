# SKN08-3rd-1Team
SKN08-3rd-1Team

<div align="center">
  <img src="https://capsule-render.vercel.app/api?type=waving&color=0:000000,70:003300,100:00FF00&height=240&text=SKN08-3rd-1Team&animation=&fontColor=00FF00&fontSize=90" width="1000" />

  <img width="1000" alt="image" src="https://github.com/Jh-jaehyuk/Jh-jaehyuk.github.io/assets/126551524/7ea63fc3-95f0-44d5-a0f0-cf431cae34f1"> 

</div>



# 1. Introduction Team (팀 소개)
### ✅ 팀명 : JOBSTICK
<table align=center>
  <tbody>
    <tr>
      <td align=center><b>왕환민</b></td>
      <td align=center><b>김현우</b></td>
      <td align=center><b>양의정</b></td>
      <td align=center><b>최병준</b></td>
      <td align=center><b>오민수</b></td>
    </tr>
    <tr>
      <td align="center">
        <div>
          <img width="200" alt="image" src="https://github.com/user-attachments/assets/d3a14a4d-9f6a-4c66-b61d-bac75bb6cc82">
        </div>
      </td>
      <td align="center">
        <div>
          <img src = "https://github.com/user-attachments/assets/ea1c1774-e583-46e8-9f43-576069ce87df" width="200px" height="200px"; alt=""/>
        </div>
      </td>
      <td align="center">
        <div>
          <img src="https://avatars.githubusercontent.com/u/100367503?v=4" width="200" height="200">
        </div>
      </td>
      <td align="center">
        <img width="200" height="200" alt="image" src="https://github.com/user-attachments/assets/f2e34e70-8c21-4864-aa4f-0b7cb619760b" />
      </td>
      <td align="center">
        <img width="200" height="200" alt="image" src="https://github.com/user-attachments/assets/bca069a5-528f-4a32-924c-b62d515fac11" />
      </td>
    </tr>
    <tr>
      <td><a href="https://github.com/minleewang"><div align=center>@Hwan-Min</div></a></td>
      <td><a href="https://github.com/kimhyeonu4586"><div align=center>@hyeonu-kim</div></a></td>
      <td><a href="https://github.com/UiJungYang"><div align=center>@UiJungYang</div></a></td>
      <td><a href="https://github.com/ChoiByuengJun"><div align=center>@ChoiByuengJun</div></a></td>
      <td><a href="https://github.com/yooodleee"><div align=center>@yooodleee</div></a></td>
    </tr>
  </tbody>
</table>
<br><br><br>



# 2. Introduction Project (프로젝트 개요)

### ✅프로젝트 명
응급처치 정보 제공 챗봇

### ✅프로젝트 소개
응급 상황에서 어떻게 대처해야 할지 몰라 막막했던 경험이 있으셨나요?
이 챗봇은 실생활에서 발생할 수 있는 다양한 응급 상황에 대해 신뢰할 수 있는 정보를 제공합니다.
공식 의료 데이터와 LLM을 연동하고 파인튜닝하여 보다 정확하고 적절한 응급처치 안내를 제공합니다.

### ✅프로젝트 목표
응급의료포털 E-GEN, 질병관리청 국가건강정보포털, 국민재난안전포털의 데이터를 활용해 LLM 기반 응급처치 질의응답 시스템을 구축합니다.
이 과정에서 모델을 설정하고 데이터를 학습하며, RAG 방식을 적용해 보다 신뢰도 높은 응답을 생성합니다.
<br><br><br>




# 3. Tech Stack (기술 스택)

>### <span style="color:cyan"> Co-Work Tool </span>
<table>
  <tr>
    <td>Communication & Messenger</td>
    <td><img src="https://img.shields.io/badge/Discord-5865F2?style=flat&logo=Discord&logoColor=white"/></td>
    <td><img src="https://img.shields.io/badge/Notion-000000?style=flat&logo=Notion&logoColor=white"/></td>
    <td><img src="https://img.shields.io/badge/Slack-4A154B?style=flat&logo=Slack&logoColor=white"/></td>
  </tr>
  <tr>
    <td>Development & Merge</td>
    <td><img src="https://img.shields.io/badge/Git-F05032?style=flat&logo=Git&logoColor=white"/></td>
    <td><img src="https://img.shields.io/badge/GitHub-181717?style=flat&logo=GitHub&logoColor=white"/></td>
    <td><img src="https://img.shields.io/badge/gitkraken-179287?style=flat&logo=Git&logoColor=gitkraken&logoColor=white"/></td>
  </tr>  
</table>

>### <span style="color:cyan"> Data Analysis </span>
<table>
  <tr>
    <td>PyCharm</td>
    <td><img src="https://img.shields.io/badge/pycharm-%23000000?style=flat&logo=pycharm&logoColor=white"/></td>
    <td><img src="https://img.shields.io/badge/python-3776AB?style=flat&logo=python&logoColor=white"/></td>
    <td><img src="https://img.shields.io/badge/chatGPT-74aa9c?logo=openai&logoColor=white"/></td>
    <td><img src="https://img.shields.io/badge/faker-FF5733?style=flat&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAYFBMVEUAAAD+/v4PDw/5+fkBAQH+/v4AAAD+/v5vb29fX19DQ0PExMT9/f3n5+eVlZW/v7+fn59UVFRLS0tLS0tUVFRsbGxMTExGRkZmZmZ2dnafn5+bm5uUlJSIiIh9fX3BwcH39/fPz8/b29vLy8t8fHyDg4ODg4Pp6em3DWVtAAAAGnRSTlMAAQIDBAUGBwgJCgsMDQ4PEBESFBUWGxs7NYqzDwAAAIlJREFUGFdlj9tygkAQhi3zKsU1aSshKWqVu7v/f7eYMHAYgmDPPfyDmy5w+lvEwKkSUer06FCFgCI3IlxaOKIZaIh6v4Sk5pWXKaZBZo5AQ9jJ58plUsZoOJS0wDygmyRzL3La3F6Tu9kEjLZ5AvO4oHvHWEk3JHE2QsKbsv02F9B6Hz3y+0JzxP8QzGQ5WaQEUxsvrG3Jl8AAAAASUVORK5CYII="/></td>
  </tr>
</table> 
<br><br><br>

# 4. 프로젝트 진행 과정
  
  ## **Preprocessing**
  
  ### 1. 데이터 수집
- 크롤링을 통해 응급처치 데이터 수집 진행
- Json으로 파일 저장

import requests
from bs4 import BeautifulSoup
import json

url = "https://www.e-gen.or.kr/egen/first_aid_data.do"
headers = {"User-Agent": "Mozilla/5.0"}
response = requests.get(url, headers=headers)

data = []
if response.status_code == 200:
    soup = BeautifulSoup(response.text, "html.parser")
    articles = soup.find_all("div", class_="first-aid-item") 

    for article in articles:
        title = article.find("h3").text.strip()
        content = article.find("p").text.strip()
        data.append({"question": title, "answer": content})

    with open("emergency_qa.json", "w", encoding="utf-8") as f: # Json 파일에 저장
        json.dump(data, f, ensure_ascii=False, indent=4)
else:
    print("페이지 요청 실패", response.status_code)




  ### 2. 파인튜닝 학습(KoAlpaca 기반 LLM 학습)
  - KoAlpaca 등 오픈소스 LLM을 응급처치 QA 데이터로 추가 학습
  - 이를 통해 챗봇이 응급처치 관련 질문에 더 정확한 답변을 제공


from transformers import AutoModelForCausalLM, AutoTokenizer, Trainer, TrainingArguments
import json

model_name = "beomi/KoAlpaca-7B" # 모델 및 토크나이저 로드
tokenizer = AutoTokenizer.from_pretrained(model_name)
model = AutoModelForCausalLM.from_pretrained(model_name)

with open("emergency_qa.json", "r", encoding="utf-8") as f: # 데이터 로드
    data = json.load(f)

train_data = [{"input_ids": tokenizer(q["question"], return_tensors="pt")["input_ids"], # 데이터 토큰화
               "labels": tokenizer(q["answer"], return_tensors="pt")["input_ids"]}
              for q in data]

training_args = TrainingArguments(   # 학습 설정
    output_dir="./fine_tuned_model",
    per_device_train_batch_size=4,
    num_train_epochs=3,
    save_steps=500,
    logging_dir="./logs"
)

trainer = Trainer(
    model=model,
    args=training_args,
    train_dataset=train_data
)

trainer.train() # 학습 실행

model.save_pretrained("./fine_tuned_emergency_model")  # 파인튜닝된 모델 저장
tokenizer.save_pretrained("./fine_tuned_emergency_model")

 


  
  ### 3. RAG(Faiss) 벡터 검색 구축
  - SBERT를 사용해 응급처치 데이터를 벡터화하고 Faiss에 저장.
  - 사용자의 질문과 가장 유사한 응급처치 정보를 빠르게 검색 가능.

import faiss
import numpy as np
import json
from sentence_transformers import SentenceTransformer

model = SentenceTransformer("snunlp/KR-SBERT-V40K-klueNLI-augSTS") # SBERT 기반 임베딩 모델 로드

with open("emergency_qa.json", "r", encoding="utf-8") as f: # 데이터 로드
    data = json.load(f)

embeddings = np.array([model.encode(q["answer"]) for q in data]) # 임베딩 변환

d = embeddings.shape[1]   # Faiss 인덱스 생성
index = faiss.IndexFlatL2(d)
index.add(embeddings)
 
faiss.write_index(index, "faiss_index.bin")  # 저장
with open("texts.json", "w", encoding="utf-8") as f:
    json.dump(data, f, ensure_ascii=False, indent=4)


  
  
  ### 4. 최종 챗봇 생성 (LLM + RAG 결합) 
  - 준비한 데이터셋과 파인튜닝 전략을 사용하여 모델을 훈련합니다.
  - 학습 과정에서 설정된 하이퍼파라미터와 최적화된 알고리즘을 기반으로 모델 매개변수를 점진적으로 조정합니다.

import faiss
import numpy as np
from transformers import AutoModelForCausalLM, AutoTokenizer
from sentence_transformers import SentenceTransformer
import json

model_path = "./fine_tuned_emergency_model"  # 모델 및 토크나이저 로드
tokenizer = AutoTokenizer.from_pretrained(model_path)
model = AutoModelForCausalLM.from_pretrained(model_path)

index = faiss.read_index("faiss_index.bin")  # Faiss 인덱스 로드
with open("texts.json", "r", encoding="utf-8") as f:
    texts = json.load(f)

embedding_model = SentenceTransformer("snunlp/KR-SBERT-V40K-klueNLI-augSTS")  # SBERT 임베딩 모델 로드

def search_and_generate(query):
    # 쿼리 벡터 변환
    query_vector = embedding_model.encode(query).reshape(1, -1)
    
    # Faiss 검색 (최상위 3개 문서)
    D, I = index.search(query_vector, k=3)
    
    # 검색된 문서들 연결
    context = "\n".join([texts[i]["answer"] for i in I[0]])

    # 모델 입력 프롬프트 생성
    prompt = f"다음 정보를 참고하여 응급처치 질문에 답변하세요:\n\n{context}\n\n질문: {query}\n답변:"

    # 모델 실행
    input_ids = tokenizer(prompt, return_tensors="pt").input_ids
    output = model.generate(input_ids, max_length=200, pad_token_id=tokenizer.eos_token_id)

    return tokenizer.decode(output[0], skip_special_tokens=True)


query = "허리를 다치면 어떻게 해?"   # 테스트
print(search_and_generate(query))



<br><br><br>


# 5. 결과
- 질문
<img width="299" alt="image" src="https://github.com/user-attachments/assets/1047d596-55c6-4dbb-86aa-445476f52614" />

- 답변
<img width="305" alt="image" src="https://github.com/user-attachments/assets/34e13665-dc5c-4ebf-a79c-fe8cbebbc3be" />
<br><br><br>

  
# 8. 한 줄 회고
🤓<b>김현우</b>  
_ 파인튜닝이라는 개념을 처음 접해봤는데 신기하였습니다.👏_

👨‍💻<b>왕환민</b>  
_LLM을 통해 이러한 것도 할 수 있다는걸 알게된 좋은 경험이었다.👏_

😺<b>양의정</b>  
_LLM을 통해 학습하고 응답을 받아보는 의미있는 시간을 가졌습니다.👏_

🪐<b>최병준</b>  
_파인튜닝을 처음 접해봤는데 이론이 어렵고 신기했다.👏_

🪐<b>오민수</b>  
_LLM이나 파인튜닝을 오랜만에 하게 되었는데 다시 해보니 좋은 경험이었다.👏_
